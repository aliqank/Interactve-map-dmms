<div id="map"></div>

<app-sidebar [map]="map" 
             (toolSelected)="handleToolSelection($event)"
             (layerControlToggled)="toggleLayerControl()"
             (searchControlToggled)="toggleSearchControl()"
             (measureControlToggled)="toggleMeasureControl()"
             (geoJsonControlToggled)="toggleGeoJsonControl()"
             (polygonControlToggled)="togglePolygonControl()"
             (dataSendingControlToggled)="toggleDataSendingControl()"
             (settingsControlToggled)="toggleSettingsControl()"
             (findLocationRequested)="findMyLocation()"></app-sidebar>

<!-- Control panels will be displayed here but not in a control-panel div -->

  
  <!-- Layer Control Panel -->
  <div *ngIf="showLayerControl" class="control-panel-content">
    <h3>Map Layers</h3>
    <div class="layer-options">
      <div class="layer-option" [class.active]="selectedLayer === 'roadmap'" (click)="changeMapLayer('roadmap')">
        <i class="fa fa-road"></i>
        <span>Road Map</span>
      </div>
      <div class="layer-option" [class.active]="selectedLayer === 'satellite'" (click)="changeMapLayer('satellite')">
        <i class="fa fa-satellite"></i>
        <span>Satellite</span>
      </div>
      <div class="layer-option" [class.active]="selectedLayer === 'hybrid'" (click)="changeMapLayer('hybrid')">
        <i class="fa fa-globe"></i>
        <span>Hybrid</span>
      </div>
      <div class="layer-option" [class.active]="selectedLayer === 'terrain'" (click)="changeMapLayer('terrain')">
        <i class="fa fa-mountain"></i>
        <span>Terrain</span>
      </div>
      <div class="layer-option" [class.active]="selectedLayer === 'osm'" (click)="changeMapLayer('osm')">
        <i class="fa fa-map-marked-alt"></i>
        <span>OpenStreetMap</span>
      </div>
    </div>
  </div>
  
  <!-- Search Control Panel -->
  <div *ngIf="showSearchControl" class="control-panel-content">
    <h3>Search Location</h3>
    <div class="search-box">
      <div class="input-with-icon">
        <i class="fa fa-search"></i>
        <input type="text" [(ngModel)]="searchQuery" (input)="onSearchInput()" placeholder="Enter location...">
      </div>
      <div *ngIf="isSearching" class="search-loading">
        <i class="fa fa-spinner fa-spin"></i> Searching...
      </div>
    </div>
    <div *ngIf="searchResults.length > 0" class="search-results">
      <div *ngFor="let result of searchResults" class="search-result-item" (click)="goToLocation(result)">
        <i class="fa fa-map-marker-alt"></i> {{ result.display_name }}
      </div>
    </div>
    
    <h3>Search by Coordinates</h3>
    <div class="coordinates-search-box">
      <div class="input-with-icon">
        <i class="fa fa-crosshairs"></i>
        <input type="text" [(ngModel)]="coordinatesQuery" placeholder="Lat, Lng (e.g. 51.5074, -0.1278)">
      </div>
      <button (click)="searchByCoordinates()" class="search-button">
        <i class="fa fa-search-location"></i> Search
      </button>
    </div>
  </div>
  
  <!-- Measurement Control Panel -->
  <div *ngIf="showMeasureControl" class="control-panel-content">
    <h3>Distance Measurement</h3>
    <p class="instruction-text">
      <i class="fa fa-info-circle"></i> Click on the map to place measurement points
    </p>
    <div *ngIf="measureDistance > 0" class="measurement-result">
      <i class="fa fa-ruler-horizontal"></i>
      <strong>Total Distance:</strong> {{ measureDistance | number:'1.2-2' }} meters
      <span *ngIf="measureDistance >= 1000">({{ measureDistance / 1000 | number:'1.2-2' }} km)</span>
    </div>
    <button (click)="clearMeasurement()" class="secondary-button">
      <i class="fa fa-trash-alt"></i> Clear Measurement
    </button>
  </div>
  
  <!-- GeoJSON Control Panel -->
  <div *ngIf="showGeoJsonControl" class="control-panel-content">
    <app-geojson-control [map]="map"></app-geojson-control>
  </div>
  
  <!-- Polygon Drawing Control Panel -->
  <div *ngIf="showPolygonControl" class="control-panel-content">
    <h3>Draw Polygon</h3>
    <p class="instruction-text">
      <i class="fa fa-info-circle"></i> Click on the map to add polygon points
    </p>
    <div class="polygon-actions">
      <button (click)="finishPolygonDrawing()" class="primary-button">
        <i class="fa fa-check"></i> Finish Polygon
      </button>
      <button (click)="cancelPolygonDrawing()" class="secondary-button">
        <i class="fa fa-times"></i> Cancel
      </button>
    </div>
  </div>
  
  <!-- Data Sending Control Panel -->
  <!-- <div *ngIf="showDataSendingControl" class="control-panel-content">
    <h3>Send Coordinates to API</h3>
    <p class="instruction-text">
      <i class="fa fa-info-circle"></i> Click on the map to send coordinates to the API
    </p>
    <div class="data-sending-info">
      <p><strong>API Endpoint:</strong> {{apiSettings.apiUrl}}</p>
      <p><strong>Status:</strong> <span class="status-active">Active</span></p>
    </div>
  </div> -->
  
  <!-- Settings Control Panel -->
  <div *ngIf="showSettingsControl" class="control-panel-content">
    <h3>API Settings</h3>
    <div class="settings-form">
      <div class="form-group">
        <label for="apiUrl">API Endpoint URL</label>
        <input type="text" id="apiUrl" [(ngModel)]="apiSettings.apiUrl" placeholder="Enter API URL">
      </div>
      <div class="form-group">
        <label for="bearerId">Bearer ID</label>
        <input type="text" id="bearerId" [(ngModel)]="apiSettings.bearerId" placeholder="Enter Bearer ID">
      </div>
      <div class="form-group">
        <label for="trackerId">Tracker ID</label>
        <input type="text" id="trackerId" [(ngModel)]="apiSettings.trackerId" placeholder="Enter Tracker ID">
      </div>
      <button (click)="saveSettings()" class="success-button">
        <i class="fa fa-save"></i> Save Settings
      </button>
    </div>
  </div>